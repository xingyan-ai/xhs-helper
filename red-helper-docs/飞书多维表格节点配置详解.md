# ğŸ“Š é£ä¹¦å¤šç»´è¡¨æ ¼èŠ‚ç‚¹é…ç½®è¯¦è§£

## ğŸ¯ é€‚ç”¨åœºæ™¯

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ Coze å·¥ä½œæµä¸­é…ç½®ã€Œé£ä¹¦å¤šç»´è¡¨æ ¼ã€èŠ‚ç‚¹ï¼Œç‰¹åˆ«æ˜¯**æŸ¥è¯¢è®°å½•**å’Œ**æ›´æ–°è®°å½•**çš„æ“ä½œã€‚

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### éœ€è¦çš„ä¿¡æ¯

1. **app_token**ï¼ˆè¡¨æ ¼æˆæƒç ï¼‰
   - è·å–æ–¹å¼ï¼šé£ä¹¦è¡¨æ ¼ â†’ é«˜çº§è®¾ç½® â†’ API è®¿é—® â†’ åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œ
   - æ ¼å¼ï¼š`pat_xxx...`

2. **table_id**ï¼ˆè¡¨æ ¼IDï¼‰
   - è·å–æ–¹å¼ï¼šä»è¡¨æ ¼é“¾æ¥ä¸­æå–
   - ç¤ºä¾‹é“¾æ¥ï¼š`https://xxx.feishu.cn/base/ABC123?table=tblXXX&view=vewYYY`
   - `table_id` å°±æ˜¯ `tblXXX` è¿™éƒ¨åˆ†

3. **å­—æ®µåç§°**
   - å¿…é¡»ä¸é£ä¹¦è¡¨æ ¼ä¸­çš„å­—æ®µå**å®Œå…¨ä¸€è‡´**
   - åŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ç­‰

---

## ğŸ” æŸ¥è¯¢è®°å½•èŠ‚ç‚¹ï¼ˆQuery Recordsï¼‰

### èŠ‚ç‚¹é…ç½®ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é£ä¹¦å¤šç»´è¡¨æ ¼ - æŸ¥è¯¢è®°å½•              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°åç§°          â”‚ å‚æ•°å€¼           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ table_id         â”‚ tblXXX          â”‚
â”‚ table_name       â”‚ è®¢å•ç®¡ç†         â”‚
â”‚ user_id_type     â”‚ open_id         â”‚
â”‚ page_token       â”‚ (ç•™ç©º)          â”‚
â”‚ page_size        â”‚ 20              â”‚
â”‚ app_token        â”‚ {{å¼€å§‹.baseToken}}â”‚
â”‚ filter           â”‚ (è§ä¸‹æ–¹)         â”‚
â”‚ sort             â”‚ (å¯é€‰)          â”‚
â”‚ view_id          â”‚ (å¯é€‰)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‚æ•°è¯¦è§£

#### 1. table_idï¼ˆå¿…å¡«ï¼‰

**è¯´æ˜ï¼š** è¡¨æ ¼çš„å”¯ä¸€æ ‡è¯†

**å¦‚ä½•è·å–ï¼š**
1. æ‰“å¼€é£ä¹¦è¡¨æ ¼
2. å¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„é“¾æ¥
3. æå– `table=` åé¢çš„éƒ¨åˆ†

**ç¤ºä¾‹ï¼š**
```
é“¾æ¥ï¼šhttps://xxx.feishu.cn/base/ABC123?table=tblngvHEiKtwElWa&view=vewYYY
table_idï¼štblngvHEiKtwElWa
```

**åœ¨ Coze ä¸­å¡«å†™ï¼š**
- å¦‚æœæ˜¯å›ºå®šçš„è¡¨æ ¼ï¼Œç›´æ¥å¡«å†™ï¼š`tblngvHEiKtwElWa`
- å¦‚æœéœ€è¦åŠ¨æ€è·å–ï¼Œå¯ä»¥ç”¨ä»£ç èŠ‚ç‚¹è§£æè¡¨æ ¼é“¾æ¥

---

#### 2. table_nameï¼ˆå¯é€‰ï¼‰

**è¯´æ˜ï¼š** è¡¨æ ¼åç§°ï¼Œä»…ç”¨äºè¯´æ˜ï¼Œä¸å½±å“åŠŸèƒ½

**å¡«å†™ï¼š** `è®¢å•ç®¡ç†` æˆ–å…¶ä»–è¡¨æ ¼åç§°

---

#### 3. user_id_typeï¼ˆå¿…å¡«ï¼‰

**è¯´æ˜ï¼š** ç”¨æˆ· ID ç±»å‹

**å¯é€‰å€¼ï¼š**
- `open_id`ï¼ˆæ¨èï¼‰
- `union_id`
- `user_id`

**å¡«å†™ï¼š** ä¿æŒé»˜è®¤ `open_id` å³å¯

---

#### 4. page_tokenï¼ˆå¯é€‰ï¼‰

**è¯´æ˜ï¼š** åˆ†é¡µæ ‡è®°ï¼Œç”¨äºè·å–ä¸‹ä¸€é¡µæ•°æ®

**ä½¿ç”¨åœºæ™¯ï¼š**
- é¦–æ¬¡æŸ¥è¯¢ï¼šç•™ç©º
- è·å–ä¸‹ä¸€é¡µï¼šå¡«å†™ä¸Šä¸€æ¬¡æŸ¥è¯¢è¿”å›çš„ `page_token`

**å¡«å†™ï¼š** é€šå¸¸ç•™ç©º

---

#### 5. page_sizeï¼ˆå¯é€‰ï¼‰

**è¯´æ˜ï¼š** æ¯é¡µè¿”å›çš„è®°å½•æ•°é‡

**é»˜è®¤å€¼ï¼š** 20

**èŒƒå›´ï¼š** 1-500

**å¡«å†™ï¼š** 
- æŸ¥è¯¢å•æ¡è®°å½•ï¼š`1`
- æŸ¥è¯¢å¤šæ¡è®°å½•ï¼š`20` æˆ–æ›´å¤§

---

#### 6. app_tokenï¼ˆå¿…å¡«ï¼‰â­ é‡è¦

**è¯´æ˜ï¼š** é£ä¹¦è¡¨æ ¼çš„æˆæƒç 

**å¡«å†™æ–¹å¼ï¼š**

**æ–¹å¼1ï¼šä½¿ç”¨è¾“å…¥å‚æ•°ï¼ˆæ¨èï¼‰**
```
{{å¼€å§‹.baseToken}}
```
è¿™æ ·å¯ä»¥è®©ç”¨æˆ·åœ¨æ’ä»¶ä¸­é…ç½®æˆæƒç ï¼Œæ— éœ€ä¿®æ”¹å·¥ä½œæµã€‚

**æ–¹å¼2ï¼šç›´æ¥å¡«å†™**
```
pat_xxxxxxxxxxxxxxxxxxxxx
```
âš ï¸ ä¸æ¨èï¼Œå› ä¸ºæˆæƒç ä¼šæš´éœ²åœ¨å·¥ä½œæµä¸­ã€‚

---

#### 7. filterï¼ˆå¯é€‰ä½†é‡è¦ï¼‰â­ æ ¸å¿ƒ

**è¯´æ˜ï¼š** ç­›é€‰æ¡ä»¶ï¼Œç”¨äºè¿‡æ»¤è®°å½•

**æ ¼å¼ï¼š** JSON å¯¹è±¡

**åŸºç¡€ç»“æ„ï¼š**
```json
{
  "conditions": [
    {
      "field_name": "å­—æ®µå",
      "operator": "æ“ä½œç¬¦",
      "value": ["å€¼"]
    }
  ],
  "conjunction": "and"
}
```

**è¯¦ç»†è¯´æ˜ï¼š**

##### conditionsï¼ˆæ¡ä»¶æ•°ç»„ï¼‰

æ¯ä¸ªæ¡ä»¶åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š

1. **field_name**ï¼šå­—æ®µåç§°
   - å¿…é¡»ä¸é£ä¹¦è¡¨æ ¼ä¸­çš„å­—æ®µå**å®Œå…¨ä¸€è‡´**
   - åŒºåˆ†å¤§å°å†™
   - åŒ…æ‹¬ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·

2. **operator**ï¼šæ“ä½œç¬¦

| æ“ä½œç¬¦ | è¯´æ˜ | é€‚ç”¨å­—æ®µç±»å‹ |
|-------|------|------------|
| `is` | ç­‰äº | æ–‡æœ¬ã€æ•°å­—ã€å•é€‰ |
| `isNot` | ä¸ç­‰äº | æ–‡æœ¬ã€æ•°å­—ã€å•é€‰ |
| `contains` | åŒ…å« | æ–‡æœ¬ |
| `doesNotContain` | ä¸åŒ…å« | æ–‡æœ¬ |
| `isEmpty` | ä¸ºç©º | æ‰€æœ‰ç±»å‹ |
| `isNotEmpty` | ä¸ä¸ºç©º | æ‰€æœ‰ç±»å‹ |
| `isGreater` | å¤§äº | æ•°å­—ã€æ—¥æœŸ |
| `isGreaterEqual` | å¤§äºç­‰äº | æ•°å­—ã€æ—¥æœŸ |
| `isLess` | å°äº | æ•°å­—ã€æ—¥æœŸ |
| `isLessEqual` | å°äºç­‰äº | æ•°å­—ã€æ—¥æœŸ |

3. **value**ï¼šå€¼
   - **å¿…é¡»æ˜¯æ•°ç»„æ ¼å¼**ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå€¼
   - ç¤ºä¾‹ï¼š`["æœ‰æ•ˆ"]` è€Œä¸æ˜¯ `"æœ‰æ•ˆ"`
   - å¯ä»¥ä½¿ç”¨å˜é‡ï¼š`["{{å¼€å§‹.orderId}}"]`

##### conjunctionï¼ˆè¿æ¥è¯ï¼‰

å¤šä¸ªæ¡ä»¶ä¹‹é—´çš„å…³ç³»ï¼š
- `and`ï¼šæ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼ˆä¸”ï¼‰
- `or`ï¼šä»»ä¸€æ¡ä»¶æ»¡è¶³ï¼ˆæˆ–ï¼‰

---

**ç¤ºä¾‹1ï¼šæŸ¥è¯¢å•ä¸ªè®¢å•**

```json
{
  "conditions": [
    {
      "field_name": "è®¢å•å·",
      "operator": "is",
      "value": ["{{å¼€å§‹.orderId}}"]
    },
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["æœ‰æ•ˆ"]
    }
  ],
  "conjunction": "and"
}
```

**è¯´æ˜ï¼š** æŸ¥è¯¢è®¢å•å·ç­‰äºè¾“å…¥å‚æ•° ä¸” çŠ¶æ€ä¸º"æœ‰æ•ˆ"çš„è®°å½•

---

**ç¤ºä¾‹2ï¼šæŸ¥è¯¢å³å°†è¿‡æœŸçš„è®¢å•**

```json
{
  "conditions": [
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["æœ‰æ•ˆ"]
    },
    {
      "field_name": "åˆ°æœŸæ—¶é—´",
      "operator": "isLessEqual",
      "value": ["2025-01-31"]
    }
  ],
  "conjunction": "and"
}
```

**è¯´æ˜ï¼š** æŸ¥è¯¢çŠ¶æ€ä¸º"æœ‰æ•ˆ" ä¸” åˆ°æœŸæ—¶é—´åœ¨ 2025-01-31 ä¹‹å‰çš„è®°å½•

---

**ç¤ºä¾‹3ï¼šæŸ¥è¯¢å¤šä¸ªçŠ¶æ€**

```json
{
  "conditions": [
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["æœ‰æ•ˆ"]
    },
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["å³å°†è¿‡æœŸ"]
    }
  ],
  "conjunction": "or"
}
```

**è¯´æ˜ï¼š** æŸ¥è¯¢çŠ¶æ€ä¸º"æœ‰æ•ˆ" æˆ– "å³å°†è¿‡æœŸ"çš„è®°å½•

---

**ç¤ºä¾‹4ï¼šå¤æ‚æ¡ä»¶ï¼ˆå‰©ä½™æ¬¡æ•°å¤§äº0ï¼‰**

```json
{
  "conditions": [
    {
      "field_name": "è®¢å•å·",
      "operator": "is",
      "value": ["{{å¼€å§‹.orderId}}"]
    },
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["æœ‰æ•ˆ"]
    },
    {
      "field_name": "å‰©ä½™æ¬¡æ•°",
      "operator": "isGreater",
      "value": ["0"]
    }
  ],
  "conjunction": "and"
}
```

**è¯´æ˜ï¼š** æŸ¥è¯¢è®¢å•å·åŒ¹é… ä¸” çŠ¶æ€æœ‰æ•ˆ ä¸” å‰©ä½™æ¬¡æ•°å¤§äº0çš„è®°å½•

---

#### 8. sortï¼ˆå¯é€‰ï¼‰

**è¯´æ˜ï¼š** æ’åºæ¡ä»¶

**æ ¼å¼ï¼š** JSON æ•°ç»„

**ç»“æ„ï¼š**
```json
[
  {
    "field_name": "å­—æ®µå",
    "desc": true
  }
]
```

**å‚æ•°ï¼š**
- `field_name`ï¼šå­—æ®µåç§°
- `desc`ï¼šæ˜¯å¦é™åº
  - `true`ï¼šé™åºï¼ˆä»å¤§åˆ°å°ï¼‰
  - `false`ï¼šå‡åºï¼ˆä»å°åˆ°å¤§ï¼‰

**ç¤ºä¾‹ï¼šæŒ‰è´­ä¹°æ—¶é—´é™åº**

```json
[
  {
    "field_name": "è´­ä¹°æ—¶é—´",
    "desc": true
  }
]
```

---

#### 9. view_idï¼ˆå¯é€‰ï¼‰

**è¯´æ˜ï¼š** è§†å›¾ IDï¼Œé™åˆ¶åœ¨ç‰¹å®šè§†å›¾ä¸­æŸ¥è¯¢

**è·å–æ–¹å¼ï¼š** ä»è¡¨æ ¼é“¾æ¥ä¸­æå– `view=` åé¢çš„éƒ¨åˆ†

**å¡«å†™ï¼š** é€šå¸¸ç•™ç©ºï¼ŒæŸ¥è¯¢æ‰€æœ‰è®°å½•

---

### è¿”å›æ•°æ®ç»“æ„

æŸ¥è¯¢æˆåŠŸåï¼ŒèŠ‚ç‚¹è¿”å›ä»¥ä¸‹æ•°æ®ï¼š

```json
{
  "items": [
    {
      "record_id": "recXXXXXX",
      "fields": {
        "è®¢å•å·": "XHS20250104001",
        "ç”¨æˆ·å": "å¼ ä¸‰",
        "æ˜¯å¦æœ‰æ•ˆ": "æœ‰æ•ˆ",
        "å‰©ä½™æ¬¡æ•°": 100,
        "åˆ°æœŸæ—¶é—´": 1735660800000
      }
    }
  ],
  "has_more": false,
  "page_token": "",
  "total": 1
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `items`ï¼šè®°å½•æ•°ç»„
  - `record_id`ï¼šè®°å½•çš„å”¯ä¸€IDï¼ˆç”¨äºæ›´æ–°æˆ–åˆ é™¤ï¼‰
  - `fields`ï¼šå­—æ®µå€¼å¯¹è±¡
- `has_more`ï¼šæ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
- `page_token`ï¼šä¸‹ä¸€é¡µçš„æ ‡è®°
- `total`ï¼šæ€»è®°å½•æ•°

---

### åœ¨ä»£ç èŠ‚ç‚¹ä¸­ä½¿ç”¨æŸ¥è¯¢ç»“æœ

```javascript
async function main(input) {
  const { items, total } = input;
  
  // æ£€æŸ¥æ˜¯å¦æŸ¥è¯¢åˆ°è®°å½•
  if (items && items.length > 0) {
    const record = items[0];
    const fields = record.fields;
    
    return {
      found: true,
      recordId: record.record_id,
      è®¢å•å·: fields['è®¢å•å·'],
      ç”¨æˆ·å: fields['ç”¨æˆ·å'],
      å‰©ä½™æ¬¡æ•°: fields['å‰©ä½™æ¬¡æ•°']
    };
  } else {
    return {
      found: false,
      message: 'æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•'
    };
  }
}
```

**è¾“å…¥æ˜ å°„ï¼š**
- `items` â†’ `{{æŸ¥è¯¢è®¢å•ä¿¡æ¯.items}}`
- `total` â†’ `{{æŸ¥è¯¢è®¢å•ä¿¡æ¯.total}}`

---

## âœï¸ æ›´æ–°è®°å½•èŠ‚ç‚¹ï¼ˆUpdate Recordï¼‰

### èŠ‚ç‚¹é…ç½®ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é£ä¹¦å¤šç»´è¡¨æ ¼ - æ›´æ–°è®°å½•              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°åç§°          â”‚ å‚æ•°å€¼           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app_token        â”‚ {{å¼€å§‹.baseToken}}â”‚
â”‚ table_id         â”‚ tblXXX          â”‚
â”‚ record_id        â”‚ {{æŸ¥è¯¢ç»“æœ.recordId}}â”‚
â”‚ fields           â”‚ (è§ä¸‹æ–¹)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‚æ•°è¯¦è§£

#### 1. app_tokenï¼ˆå¿…å¡«ï¼‰

åŒæŸ¥è¯¢èŠ‚ç‚¹ï¼Œå¡«å†™ï¼š`{{å¼€å§‹.baseToken}}`

---

#### 2. table_idï¼ˆå¿…å¡«ï¼‰

åŒæŸ¥è¯¢èŠ‚ç‚¹ï¼Œå¡«å†™ï¼š`tblngvHEiKtwElWa`

---

#### 3. record_idï¼ˆå¿…å¡«ï¼‰â­ é‡è¦

**è¯´æ˜ï¼š** è¦æ›´æ–°çš„è®°å½•ID

**è·å–æ–¹å¼ï¼š** ä»æŸ¥è¯¢èŠ‚ç‚¹çš„è¿”å›ç»“æœä¸­è·å–

**å¡«å†™ï¼š** `{{æŸ¥è¯¢è®¢å•ä¿¡æ¯.items[0].record_id}}`

æˆ–è€…åœ¨ä»£ç èŠ‚ç‚¹ä¸­å¤„ç†åï¼š`{{å¤„ç†éªŒè¯ç»“æœ.recordId}}`

---

#### 4. fieldsï¼ˆå¿…å¡«ï¼‰â­ æ ¸å¿ƒ

**è¯´æ˜ï¼š** è¦æ›´æ–°çš„å­—æ®µå’Œå€¼

**æ ¼å¼ï¼š** JSON å¯¹è±¡

**ç»“æ„ï¼š**
```json
{
  "å­—æ®µå1": "æ–°å€¼1",
  "å­—æ®µå2": æ–°å€¼2,
  "å­—æ®µå3": {
    "link": "é“¾æ¥åœ°å€",
    "text": "é“¾æ¥æ–‡æœ¬"
  }
}
```

---

**ç¤ºä¾‹1ï¼šæ›´æ–°ä½¿ç”¨æ¬¡æ•°**

```json
{
  "å‰©ä½™æ¬¡æ•°": 99,
  "å·²ä½¿ç”¨æ¬¡æ•°": 1,
  "æœ€åä½¿ç”¨æ—¶é—´": "2025-01-04 15:30:00"
}
```

---

**ç¤ºä¾‹2ï¼šä½¿ç”¨å˜é‡**

```json
{
  "å‰©ä½™æ¬¡æ•°": {{è®¡ç®—ç»“æœ.newCount}},
  "å·²ä½¿ç”¨æ¬¡æ•°": {{è®¡ç®—ç»“æœ.usedCount}},
  "æœ€åä½¿ç”¨æ—¶é—´": "{{å½“å‰æ—¶é—´}}"
}
```

---

**ç¤ºä¾‹3ï¼šæ›´æ–°è¶…é“¾æ¥å­—æ®µ**

```json
{
  "è®¢å•è¯¦æƒ…": {
    "link": "https://example.com/order/123",
    "text": "æŸ¥çœ‹è®¢å•"
  }
}
```

---

**ç¤ºä¾‹4ï¼šæ›´æ–°å•é€‰å­—æ®µ**

```json
{
  "æ˜¯å¦æœ‰æ•ˆ": "å·²è¿‡æœŸ"
}
```

âš ï¸ æ³¨æ„ï¼šå•é€‰å­—æ®µçš„å€¼å¿…é¡»æ˜¯é¢„è®¾é€‰é¡¹ä¸­çš„ä¸€ä¸ª

---

### è¿”å›æ•°æ®ç»“æ„

æ›´æ–°æˆåŠŸåï¼ŒèŠ‚ç‚¹è¿”å›ï¼š

```json
{
  "record": {
    "record_id": "recXXXXXX",
    "fields": {
      "è®¢å•å·": "XHS20250104001",
      "å‰©ä½™æ¬¡æ•°": 99,
      "å·²ä½¿ç”¨æ¬¡æ•°": 1,
      ...
    }
  }
}
```

---

## ğŸ”— å®Œæ•´ç¤ºä¾‹ï¼šè®¢å•éªŒè¯ä¸æ¬¡æ•°æ‰£å‡

### å·¥ä½œæµç»“æ„

```
å¼€å§‹
  â†“
æŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼ˆé£ä¹¦å¤šç»´è¡¨æ ¼ - æŸ¥è¯¢è®°å½•ï¼‰
  â†“
å¤„ç†éªŒè¯ç»“æœï¼ˆä»£ç èŠ‚ç‚¹ï¼‰
  â†“
æ¡ä»¶åˆ¤æ–­ï¼ˆè®¢å•æ˜¯å¦æœ‰æ•ˆï¼Ÿï¼‰
  â”œâ”€ æ˜¯ â†’ ç»§ç»­
  â””â”€ å¦ â†’ è¿”å›é”™è¯¯
  â†“
å†™å…¥æ•°æ®åˆ°ç›®æ ‡è¡¨æ ¼
  â†“
è®¡ç®—æ–°çš„å‰©ä½™æ¬¡æ•°ï¼ˆä»£ç èŠ‚ç‚¹ï¼‰
  â†“
æ›´æ–°è®¢å•ä½¿ç”¨æ¬¡æ•°ï¼ˆé£ä¹¦å¤šç»´è¡¨æ ¼ - æ›´æ–°è®°å½•ï¼‰
  â†“
è¿”å›æˆåŠŸ
```

---

### èŠ‚ç‚¹1ï¼šæŸ¥è¯¢è®¢å•ä¿¡æ¯

**èŠ‚ç‚¹ç±»å‹ï¼š** é£ä¹¦å¤šç»´è¡¨æ ¼ - æŸ¥è¯¢è®°å½•

**é…ç½®ï¼š**

| å‚æ•° | å€¼ |
|-----|---|
| table_id | `tblngvHEiKtwElWa` |
| app_token | `{{å¼€å§‹.baseToken}}` |
| page_size | `1` |
| filter | è§ä¸‹æ–¹ |

**filter é…ç½®ï¼š**

```json
{
  "conditions": [
    {
      "field_name": "è®¢å•å·",
      "operator": "is",
      "value": ["{{å¼€å§‹.orderId}}"]
    },
    {
      "field_name": "æ˜¯å¦æœ‰æ•ˆ",
      "operator": "is",
      "value": ["æœ‰æ•ˆ"]
    }
  ],
  "conjunction": "and"
}
```

---

### èŠ‚ç‚¹2ï¼šå¤„ç†éªŒè¯ç»“æœ

**èŠ‚ç‚¹ç±»å‹ï¼š** ä»£ç 

**ä»£ç ï¼š**

```javascript
async function main(input) {
  const { items } = input;
  
  if (items && items.length > 0) {
    const record = items[0];
    const fields = record.fields;
    
    return {
      orderId_result: true,
      message: 'è®¢å•éªŒè¯æˆåŠŸ',
      recordId: record.record_id,
      orderInfo: {
        è®¢å•å·: fields['è®¢å•å·'],
        ç”¨æˆ·å: fields['ç”¨æˆ·å'],
        å‰©ä½™æ¬¡æ•°: fields['å‰©ä½™æ¬¡æ•°'] || 0,
        å·²ä½¿ç”¨æ¬¡æ•°: fields['å·²ä½¿ç”¨æ¬¡æ•°'] || 0
      }
    };
  } else {
    return {
      orderId_result: false,
      message: 'è®¢å•å·æ— æ•ˆæˆ–å·²è¿‡æœŸ'
    };
  }
}
```

**è¾“å…¥æ˜ å°„ï¼š**
- `items` â†’ `{{æŸ¥è¯¢è®¢å•ä¿¡æ¯.items}}`

---

### èŠ‚ç‚¹3ï¼šæ¡ä»¶åˆ¤æ–­

**æ¡ä»¶ï¼š** `{{å¤„ç†éªŒè¯ç»“æœ.orderId_result}} == true`

---

### èŠ‚ç‚¹4ï¼šè®¡ç®—æ–°çš„å‰©ä½™æ¬¡æ•°

**èŠ‚ç‚¹ç±»å‹ï¼š** ä»£ç 

**ä»£ç ï¼š**

```javascript
async function main(input) {
  const { orderInfo } = input;
  
  const currentCount = orderInfo.å‰©ä½™æ¬¡æ•° || 0;
  const usedCount = orderInfo.å·²ä½¿ç”¨æ¬¡æ•° || 0;
  
  return {
    newCount: Math.max(0, currentCount - 1),
    newUsedCount: usedCount + 1,
    shouldUpdate: currentCount > 0
  };
}
```

**è¾“å…¥æ˜ å°„ï¼š**
- `orderInfo` â†’ `{{å¤„ç†éªŒè¯ç»“æœ.orderInfo}}`

---

### èŠ‚ç‚¹5ï¼šæ›´æ–°è®¢å•ä½¿ç”¨æ¬¡æ•°

**èŠ‚ç‚¹ç±»å‹ï¼š** é£ä¹¦å¤šç»´è¡¨æ ¼ - æ›´æ–°è®°å½•

**é…ç½®ï¼š**

| å‚æ•° | å€¼ |
|-----|---|
| app_token | `{{å¼€å§‹.baseToken}}` |
| table_id | `tblngvHEiKtwElWa` |
| record_id | `{{å¤„ç†éªŒè¯ç»“æœ.recordId}}` |
| fields | è§ä¸‹æ–¹ |

**fields é…ç½®ï¼š**

```json
{
  "å‰©ä½™æ¬¡æ•°": {{è®¡ç®—æ–°çš„å‰©ä½™æ¬¡æ•°.newCount}},
  "å·²ä½¿ç”¨æ¬¡æ•°": {{è®¡ç®—æ–°çš„å‰©ä½™æ¬¡æ•°.newUsedCount}},
  "æœ€åä½¿ç”¨æ—¶é—´": "{{å½“å‰æ—¶é—´}}"
}
```

---

## âš ï¸ å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

### é”™è¯¯1ï¼šå­—æ®µåä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯ï¼š** `field not found: è®¢å•å·`

**åŸå› ï¼š** å­—æ®µåç§°ä¸é£ä¹¦è¡¨æ ¼ä¸­çš„ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥é£ä¹¦è¡¨æ ¼ä¸­çš„å­—æ®µåï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ï¼‰
2. ç¡®ä¿ä»£ç ä¸­çš„å­—æ®µåä¸è¡¨æ ¼å®Œå…¨ä¸€è‡´
3. åŒºåˆ†å¤§å°å†™

---

### é”™è¯¯2ï¼šfilter æ ¼å¼é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `invalid filter format`

**åŸå› ï¼š** filter çš„ JSON æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ `value` æ˜¯æ•°ç»„æ ¼å¼ï¼š`["å€¼"]` è€Œä¸æ˜¯ `"å€¼"`
2. æ£€æŸ¥ JSON è¯­æ³•ï¼ˆé€—å·ã€å¼•å·ã€æ‹¬å·ï¼‰
3. ä½¿ç”¨ JSON éªŒè¯å·¥å…·æ£€æŸ¥æ ¼å¼

---

### é”™è¯¯3ï¼šrecord_id æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯ï¼š** `record not found`

**åŸå› ï¼š** record_id ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å…ˆæ‰§è¡ŒæŸ¥è¯¢èŠ‚ç‚¹è·å– record_id
2. æ£€æŸ¥å˜é‡å¼•ç”¨æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤è®°å½•æœªè¢«åˆ é™¤

---

### é”™è¯¯4ï¼šæƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯ï¼š** `permission denied`

**åŸå› ï¼š** app_token æ²¡æœ‰ç›¸åº”æƒé™

**è§£å†³æ–¹æ¡ˆï¼š**
1. é‡æ–°ç”Ÿæˆ app_token
2. ç¡®ä¿å‹¾é€‰äº†ã€Œè¯»å–è®°å½•ã€å’Œã€Œç¼–è¾‘è®°å½•ã€æƒé™
3. æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å˜é‡è€Œéç¡¬ç¼–ç 

âŒ ä¸æ¨èï¼š
```json
{
  "app_token": "pat_xxxxxxxxxxxxx"
}
```

âœ… æ¨èï¼š
```json
{
  "app_token": "{{å¼€å§‹.baseToken}}"
}
```

---

### 2. æ·»åŠ é”™è¯¯å¤„ç†

åœ¨ä»£ç èŠ‚ç‚¹ä¸­æ·»åŠ  try-catchï¼š

```javascript
async function main(input) {
  try {
    const { items } = input;
    
    if (!items || items.length === 0) {
      return {
        success: false,
        message: 'æœªæ‰¾åˆ°è®°å½•'
      };
    }
    
    // å¤„ç†é€»è¾‘...
    
    return {
      success: true,
      data: result
    };
  } catch (error) {
    return {
      success: false,
      message: `å¤„ç†å¤±è´¥: ${error.message}`
    };
  }
}
```

---

### 3. è®°å½•æ—¥å¿—

åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ—¥å¿—è¾“å‡ºï¼š

```javascript
async function main(input) {
  console.log('è¾“å…¥å‚æ•°:', JSON.stringify(input));
  
  // å¤„ç†é€»è¾‘...
  
  console.log('å¤„ç†ç»“æœ:', JSON.stringify(result));
  return result;
}
```

---

### 4. åˆ†é¡µå¤„ç†å¤§é‡æ•°æ®

å¦‚æœéœ€è¦æŸ¥è¯¢å¤§é‡è®°å½•ï¼š

```javascript
async function main(input) {
  let allRecords = [];
  let pageToken = '';
  let hasMore = true;
  
  while (hasMore) {
    // è°ƒç”¨æŸ¥è¯¢èŠ‚ç‚¹ï¼ˆéœ€è¦åœ¨å·¥ä½œæµä¸­å¾ªç¯ï¼‰
    const result = await queryRecords(pageToken);
    
    allRecords = allRecords.concat(result.items);
    hasMore = result.has_more;
    pageToken = result.page_token;
  }
  
  return {
    records: allRecords,
    total: allRecords.length
  };
}
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ Coze å·¥ä½œæµçš„è¿è¡Œæ—¥å¿—
2. æ£€æŸ¥é£ä¹¦è¡¨æ ¼çš„å­—æ®µé…ç½®
3. ä½¿ç”¨ JSON éªŒè¯å·¥å…·æ£€æŸ¥æ ¼å¼
4. å‚è€ƒæœ¬æ–‡æ¡£çš„ç¤ºä¾‹ä»£ç 

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** V1.0  
**æœ€åæ›´æ–°ï¼š** 2025-01-04  
**ä½œè€…ï¼š** çº¢è–¯åŠ©æ‰‹å›¢é˜Ÿ

