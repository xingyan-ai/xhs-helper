# 红薯助手 PRD V1.0

**文档版本**：V1.0  
**创建日期**：2025-01-03  
**产品负责人**：[您的名字]  
**目标版本**：V1.0 MVP

---

## 📌 文档目录

1. [产品概述](#1-产品概述)
2. [需求背景与目标](#2-需求背景与目标)
3. [功能清单与优先级](#3-功能清单与优先级)
4. [核心功能详细设计](#4-核心功能详细设计)
5. [数据结构设计](#5-数据结构设计)
6. [技术实现方案](#6-技术实现方案)
7. [用户安装配置流程](#7-用户安装配置流程)
8. [开发计划与里程碑](#8-开发计划与里程碑)
9. [风险评估与应对](#9-风险评估与应对)

---

## 1. 产品概述

### 1.1 产品定位

**红薯助手**是一款专为小红书用户设计的Chrome浏览器插件，帮助用户高效采集和管理小红书笔记数据，并支持一键同步到飞书多维表格。

**核心特点**：
- 本地化部署，无需注册登录
- 数据完全由用户掌控
- 通过zip包分发，手动加载安装

### 1.2 目标用户

**主要用户群**：小红书内容创作者、运营人员、数据分析师

**典型用户画像**：

| 用户类型 | 使用场景 | 核心诉求 |
|---------|---------|---------|
| 内容创作者 | 收集灵感素材 | 快速保存优质笔记，建立个人素材库 |
| 小红书运营 | 竞品分析 | 批量采集竞争对手的笔记数据，分析爆款规律 |
| 数据分析师 | 行业研究 | 采集特定博主/话题的数据，导出分析 |
| 个人用户 | 知识管理 | 保存感兴趣的笔记，方便后续查阅 |

### 1.3 核心价值

1. **自动化采集**：告别手动复制粘贴，一键获取完整数据
2. **结构化存储**：数据自动整理成表格，方便分析和管理
3. **多维度数据**：不仅采集内容，还包含互动数据、发布时间等元信息
4. **隐私可控**：本地运行，数据存储完全由用户控制

---

## 2. 需求背景与目标

### 2.1 需求背景

**用户痛点**：
1. 小红书没有官方的批量导出功能
2. 手动复制笔记信息效率低，容易遗漏关键数据
3. 采集的数据散乱，难以系统化管理和分析
4. 需要频繁在小红书和笔记工具之间切换

**市场机会**：
- 小红书用户规模庞大，内容运营需求旺盛
- 现有采集工具多为商业化产品，门槛较高
- 开源/私有分发的轻量级工具有使用空间

### 2.2 V1.0 目标

**功能目标**：
- ✅ 实现单篇笔记精准采集
- ✅ 实现博主全部笔记批量采集
- ✅ 实现博主基础信息采集
- ✅ 支持数据导出为Excel格式
- ✅ 支持数据同步到飞书多维表格

**质量目标**：
- 采集准确率 ≥ 95%
- 单个博主笔记采集成功率 ≥ 90%
- 平均采集速度：50-100条笔记/分钟

**用户体验目标**：
- 插件安装成功率 ≥ 80%
- 配置流程 ≤ 5分钟
- 核心操作步骤 ≤ 3步

---

## 3. 功能清单与优先级

### 3.1 功能模块总览

```
红薯助手 V1.0
├── 数据采集模块
│   ├── 单篇笔记采集 (P0)
│   ├── 博主全部笔记采集 (P0)
│   └── 博主信息采集 (P0)
├── 数据管理模块
│   ├── 采集结果展示 (P0)
│   ├── 数据清空/删除 (P0)
│   └── 数据筛选/排序 (P1 - 暂不实现)
├── 数据导出模块
│   └── 导出Excel (P0)
├── 数据同步模块
│   ├── 飞书配置管理 (P0)
│   └── 飞书数据同步 (P0)
└── 用户引导模块
    ├── 使用说明 (P0)
    └── 错误提示 (P0)
```

### 3.2 功能优先级定义

| 优先级 | 说明 | V1.0包含 |
|-------|------|---------|
| P0 | 核心功能，必须实现 | ✅ |
| P1 | 重要功能，后续迭代 | ❌ |
| P2 | 增强功能，按需实现 | ❌ |

### 3.3 V1.0 功能清单

| 功能模块 | 功能点 | 优先级 | V1.0状态 |
|---------|-------|--------|---------|
| **单篇笔记采集** | | | |
| | 检测笔记详情页 | P0 | ✅ 实现 |
| | 提取笔记基础信息（标题、作者、正文） | P0 | ✅ 实现 |
| | 提取互动数据（点赞、收藏、评论数） | P0 | ✅ 实现 |
| | 提取图片链接 | P0 | ✅ 实现 |
| | 提取视频链接 | P0 | ✅ 实现 |
| | 提取话题标签 | P0 | ✅ 实现 |
| | 提取发布时间 | P0 | ✅ 实现 |
| **博主笔记采集** | | | |
| | 检测博主主页 | P0 | ✅ 实现 |
| | 自动滚动加载笔记 | P0 | ✅ 实现 |
| | 批量提取笔记信息 | P0 | ✅ 实现 |
| | 采集进度实时反馈 | P0 | ✅ 实现 |
| | 去重处理 | P0 | ✅ 实现 |
| **博主信息采集** | | | |
| | 提取博主名称 | P0 | ✅ 实现 |
| | 提取博主头像 | P0 | ✅ 实现 |
| | 提取小红书号 | P0 | ✅ 实现 |
| | 提取博主简介 | P0 | ✅ 实现 |
| | 提取粉丝数 | P0 | ✅ 实现 |
| **数据展示** | | | |
| | 卡片式结果展示 | P0 | ✅ 实现 |
| | 单条数据删除 | P0 | ✅ 实现 |
| | 批量清空 | P0 | ✅ 实现 |
| **数据导出** | | | |
| | 导出为CSV格式 | P0 | ✅ 实现 |
| | 中文编码处理 | P0 | ✅ 实现 |
| **飞书同步** | | | |
| | 飞书配置管理 | P0 | ✅ 实现 |
| | 单篇笔记同步 | P0 | ✅ 实现 |
| | 博主笔记批量同步 | P0 | ✅ 实现 |
| | 博主信息同步 | P0 | ✅ 实现 |

---

## 4. 核心功能详细设计

### 4.1 单篇笔记采集

#### 4.1.1 功能描述

用户打开小红书笔记详情页后，点击"开始采集"按钮，插件自动提取笔记的完整信息。

#### 4.1.2 用户流程

```
用户打开小红书笔记详情页
    ↓
点击浏览器插件图标，打开侧边栏
    ↓
切换到"单篇笔记"Tab
    ↓
点击"开始采集"按钮
    ↓
插件自动提取数据（1-3秒）
    ↓
采集结果显示在卡片中
    ↓
用户可选择：
- 导出Excel
- 同步到飞书
- 清空重新采集
```

#### 4.1.3 页面检测逻辑

**触发条件**：
- URL匹配：`xiaohongshu.com/explore/` 或 `xiaohongshu.com/discovery/item`
- DOM元素验证：页面包含笔记容器元素

**检测失败提示**：
```
"请确保在小红书笔记详情页上使用此功能"
```

#### 4.1.4 数据提取规则

| 数据字段 | 提取方式 | 备选方案 | 异常处理 |
|---------|---------|---------|---------|
| 笔记标题 | `.title` | `.note-title`, `h1` | 默认"无标题" |
| 作者名称 | `.author .name` | `.nickname`, `.user-name` | 默认"未知作者" |
| 正文内容 | `.note-text` | `#detail-desc .desc` | 默认空字符串 |
| 点赞数 | `.like-wrapper .count` | 多个选择器备选 | 默认0 |
| 收藏数 | `.collect-wrapper .count` | 多个选择器备选 | 默认0 |
| 评论数 | `.chat-wrapper .count` | 多个选择器备选 | 默认0 |
| 话题标签 | `.tag` | 提取所有标签元素 | 默认空数组 |
| 图片链接 | `.swiper-slide img` | 过滤头像和占位图 | 默认空数组 |
| 视频链接 | `video` 元素 | 网络请求监听 | 仅视频笔记有值 |
| 发布时间 | `.date` | 多格式解析 | 默认空字符串 |

#### 4.1.5 数据格式转换

**时间格式处理**：
```javascript
// 输入：昨天 23:31
// 输出：2025/01/02 23:31

// 输入：2天前
// 输出：2025/01/01 20:00

// 输入：12-13
// 输出：2024/12/13 20:00
```

**互动数据处理**：
```javascript
// 1.2w → 12000
// 500 → 500
// 1.5k → 1500
```

**话题标签处理**：
```javascript
// 输入：#旅行 #美食
// 输出：旅行,美食（去除#符号）
```

#### 4.1.6 交互细节

**按钮状态**：
- 默认状态：蓝色，"开始采集"
- 采集中：灰色禁用，"采集ing..."
- 采集成功：恢复默认状态

**状态提示**：
- 采集中：`正在采集单篇笔记，请稍后...`
- 成功：`成功采集到单篇笔记`
- 失败：`采集失败：[具体错误原因]`

**超时处理**：
- 设置15秒超时
- 超时后提示：`采集超时，请刷新页面后重试`

---

### 4.2 博主全部笔记采集

#### 4.2.1 功能描述

用户打开博主主页后，插件自动滚动页面，批量采集该博主发布的所有笔记信息。

#### 4.2.2 用户流程

```
用户打开博主主页
    ↓
点击插件图标，打开侧边栏
    ↓
切换到"博主笔记"Tab
    ↓
点击"开始采集"按钮
    ↓
插件自动滚动页面，实时显示进度
    ↓
采集完成，显示所有笔记卡片
    ↓
用户可选择：
- 删除单条笔记
- 导出Excel
- 批量同步到飞书
- 清空所有数据
```

#### 4.2.3 页面检测逻辑

**触发条件**：
- URL匹配：`xiaohongshu.com/user/profile/`
- DOM元素验证：页面包含用户信息容器

**检测失败提示**：
```
"请确保在小红书博主主页上使用此功能，并等待页面完全加载"
```

#### 4.2.4 滚动加载策略

**核心逻辑**：
```javascript
初始化：
  - 滚动到顶部重置状态
  - 设置滚动参数（步长500px，最大50次，无新内容上限5次）

循环滚动：
  1. 获取当前页面所有笔记卡片
  2. 提取新笔记信息（跳过已采集）
  3. 滚动页面500px
  4. 等待1.5秒加载
  5. 判断是否继续：
     - 有新内容 → 继续
     - 连续5次无新内容 → 停止
     - 达到50次 → 停止

结束处理：
  - 滚动到底部最后采集一次
  - 返回采集结果
```

**进度反馈**：
```
正在采集第10/50批内容...
已发现23条笔记
```

#### 4.2.5 数据提取规则

| 数据字段 | 提取方式 | 去重依据 |
|---------|---------|---------|
| 笔记标题 | `.title`, `.note-title` | - |
| 笔记链接 | `a[href]` | URL去重 |
| 作者名称 | `.author`, `.user-name` | - |
| 点赞数 | XPath查询 | - |
| 封面图片 | `img` 元素 | 过滤头像 |

**URL处理**：
```javascript
// 清理用户ID路径
// 输入：/user/profile/xxx/discovery/item/yyy
// 输出：/discovery/item/yyy

// 补全域名
// 输入：/discovery/item/yyy
// 输出：https://www.xiaohongshu.com/explore/discovery/item/yyy
```

#### 4.2.6 异常处理

| 异常场景 | 处理方式 |
|---------|---------|
| 采集到0条笔记 | 提示：未能采集到任何链接，请确保在博主主页 |
| 网络加载慢 | 增加等待时间到2秒 |
| 页面改版导致选择器失效 | 使用多个备选选择器 |
| 用户中途关闭插件 | 清理全局变量，停止采集 |

---

### 4.3 博主信息采集

#### 4.3.1 功能描述

用户打开博主主页后，一键提取博主的基础信息（名称、头像、简介、粉丝数等）。

#### 4.3.2 用户流程

```
用户打开博主主页
    ↓
切换到"博主信息"Tab
    ↓
点击"开始采集"按钮
    ↓
插件提取博主信息（1-2秒）
    ↓
显示博主信息卡片
    ↓
用户可选择：
- 导出Excel
- 同步到飞书
- 清空数据
```

#### 4.3.3 数据提取规则

| 数据字段 | 提取方式 | 默认值 |
|---------|---------|--------|
| 博主名称 | `.user-name`, `.nickname` | "未知博主" |
| 头像链接 | `.avatar img` | 空字符串 |
| 小红书号 | `.user-redId` | 空字符串 |
| 博主简介 | `.bio`, `.description` | 空字符串 |
| 粉丝数 | `.followers` + 数字转换 | 0 |
| 主页链接 | 当前页面URL | - |
| 采集时间 | 当前时间戳 | - |

**粉丝数处理**：
```javascript
// 1.2万 → 12000
// 500 → 500
// 10w → 100000
```

---

### 4.4 数据导出功能

#### 4.4.1 导出格式

**单篇笔记导出**：
```csv
标题,笔记链接,笔记类型,作者,正文,话题标签,封面链接,全部图片链接,视频链接,点赞数,收藏数,评论数,发布时间,采集时间
```

**博主笔记导出**：
```csv
标题,链接,作者,点赞数,图片链接
```

**博主信息导出**：
```csv
博主名称,头像链接,小红书号,简介,粉丝数,博主主页链接,采集时间
```

#### 4.4.2 文件命名规则

```
小红书单篇笔记_2025-01-03.csv
小红书笔记_2025-01-03.csv
小红书博主信息_2025-01-03.csv
```

#### 4.4.3 中文编码处理

**关键技术点**：
```javascript
// 添加BOM头确保Excel正确识别UTF-8
let csvContent = '\ufeff标题,作者,点赞数\n';

// 处理特殊字符（逗号、引号）
const title = note.title
  .replace(/"/g, '""')  // 双引号转义
  .replace(/,/g, '，');  // 逗号替换为中文逗号

// 设置正确的MIME类型
const blob = new Blob([csvContent], { 
  type: 'text/csv;charset=utf-8;' 
});
```

---

### 4.5 飞书同步功能

#### 4.5.1 配置管理

**配置项**：
| 配置项 | 说明 | 必填 | 示例 |
|-------|------|------|------|
| 订单号 | 用于验证用户权限 | ✅ | 202501030001 |
| 多维表格授权码 | basetoken，飞书表格访问凭证 | ✅ | bascxxxxx |
| 「采集库」表格链接 | 单篇笔记同步目标 | 单篇同步时必填 | https://xxx.feishu.cn/base/xxx |
| 「小红书博主库」表格链接 | 博主信息同步目标 | 博主同步时必填 | https://xxx.feishu.cn/base/xxx |
| 「小红书博主笔记」表格链接 | 博主笔记同步目标 | 批量同步时必填 | https://xxx.feishu.cn/base/xxx |

**存储方式**：
```javascript
localStorage.setItem('feishuConfig', JSON.stringify(config));
```

#### 4.5.2 数据格式转换

**单篇笔记同步格式**：
```json
{
  "records": [{
    "fields": {
      "作者名称": "xxx",
      "封面链接": "https://...",
      "笔记标题": "xxx",
      "原文地址": {
        "link": "https://...",
        "text": "查看原文"
      },
      "正文内容": "xxx",
      "话题标签": ["标签1", "标签2"],
      "图片链接": "图1=(url1)\n图2=(url2)",
      "点赞数": 1000,
      "收藏数": 500,
      "评论数": 200,
      "类型": "图文",
      "域名": "小红书",
      "采集时间": 1704268800000,
      "发布时间": 1704268800000
    }
  }]
}
```

**博主笔记同步格式**：
```json
{
  "records": [{
    "fields": {
      "博主": "xxx",
      "标题": "xxx",
      "点赞数": 1000,
      "笔记链接": {
        "link": "https://...",
        "text": "查看原文"
      },
      "封面链接": "https://..."
    }
  }]
}
```

**博主信息同步格式**：
```json
{
  "records": [{
    "fields": {
      "博主名称": "xxx",
      "头像链接": "https://...",
      "小红书号": "123456789",
      "简介": "xxx",
      "粉丝数": 50000,
      "主页链接": {
        "link": "https://...",
        "text": "查看原文"
      },
      "采集时间": 1704268800000
    }
  }]
}
```

#### 4.5.3 API调用流程

```
1. 读取本地飞书配置
   ↓
2. 验证配置完整性
   ↓
3. 格式化采集数据
   ↓
4. 调用Coze工作流API
   ↓
5. 解析响应结果
   ↓
6. 显示同步状态
```

**API请求示例**：
```javascript
fetch('https://api.coze.cn/v1/workflow/run', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer [token]',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    workflow_id: '[工作流ID]',
    parameters: {
      ordeid: config.ordeid,
      basetoken: config.basetoken,
      knowledgeurl: config.knowledgeurl,
      body: JSON.stringify(dataObject)
    }
  })
})
```

#### 4.5.4 错误处理

| 错误类型 | 判断条件 | 提示信息 |
|---------|---------|---------|
| 配置缺失 | 订单号或授权码为空 | "请先配置完整的飞书信息" |
| 网络错误 | response.ok = false | "网络请求失败，请检查网络连接" |
| 订单号无效 | ordeid_result = false | "订单号不存在或已过期" |
| 同步失败 | add_result = false | "同步失败，请稍后重试" |
| 成功 | add_result && ordeid_result | "同步成功，去表格看看吧" |

---

### 4.6 用户界面设计

#### 4.6.1 侧边栏布局

```
┌─────────────────────────────────┐
│  红薯助手                        │ ← 顶部标题
│  需要帮助？点击这里               │ ← 帮助链接
├─────────────────────────────────┤
│  [状态提示区域]                  │ ← 操作反馈
├─────────────────────────────────┤
│ [单篇笔记] [博主笔记] [博主信息] [配置] │ ← Tab切换
├─────────────────────────────────┤
│                                 │
│  [开始采集按钮]                  │
│                                 │
│  [操作按钮组]                    │
│  [清空] [导出] [同步飞书]        │
│                                 │
│  [采集结果展示区]                │
│  ┌────────────────────────┐    │
│  │  [笔记卡片1]           │    │
│  │  [笔记卡片2]           │    │
│  │  [笔记卡片3]           │    │
│  └────────────────────────┘    │
│                                 │
└─────────────────────────────────┘
```

#### 4.6.2 配色方案（避免与原版相同）

**建议配色**：
```css
/* 主色调：深绿色系（代表"红薯"的藤蔓） */
--primary-color: #2D7A4A;      /* 主按钮颜色 */
--primary-hover: #236038;       /* 悬停颜色 */

/* 辅助色：暖橙色（代表"红薯"） */
--accent-color: #E67E22;        /* 强调色 */

/* 背景色 */
--bg-primary: #FFFFFF;
--bg-secondary: #F5F7FA;

/* 文字色 */
--text-primary: #2C3E50;
--text-secondary: #7F8C8D;

/* 状态色 */
--success: #27AE60;
--warning: #F39C12;
--error: #E74C3C;
```

#### 4.6.3 卡片样式

**笔记卡片**：
```
┌──────────────────────────┐
│ [序号]                   │
│ ┌────────────────────┐  │
│ │   [封面图片]       │  │
│ └────────────────────┘  │
│ [笔记标题]               │
│ [作者名称]               │
│ 点赞数: 1000             │
│                 [删除]    │
└──────────────────────────┘
```

#### 4.6.4 按钮状态设计

| 按钮 | 默认状态 | 禁用状态 | 加载状态 |
|------|---------|---------|---------|
| 开始采集 | 绿色可点击 | 灰色不可点击 | 显示"采集ing..." |
| 导出Excel | 蓝色可点击 | 灰色（无数据时） | - |
| 同步飞书 | 橙色可点击 | 灰色（无数据时） | 显示"同步中..." |
| 清空 | 红色可点击 | 灰色（无数据时） | - |

---

## 5. 数据结构设计

### 5.1 单篇笔记数据结构

```typescript
interface SingleNote {
  url: string;                    // 笔记链接
  title: string;                  // 笔记标题
  author: string;                 // 作者名称
  content: string;                // 正文内容
  tags: string;                   // 话题标签（逗号分隔）
  likes: number;                  // 点赞数
  collects: number;               // 收藏数
  comments: number;               // 评论数
  publishDate: string;            // 发布时间（格式：YYYY/MM/DD HH:mm）
  imageUrls: string;              // 图片链接（逗号分隔）
  formattedImageUrls: string;     // 格式化图片链接（图1=(url)\n图2=(url)）
  noteType: string;               // 笔记类型（"图文" | "视频"）
  coverImageUrl: string;          // 封面链接（第一张图）
  videoUrl?: string;              // 视频链接（仅视频笔记）
  captureTimestamp: number;       // 采集时间戳
  captureRemark: string;          // 采集备注
}
```

### 5.2 博主笔记数据结构

```typescript
interface BloggerNote {
  title: string;        // 笔记标题
  url: string;          // 笔记链接
  author: string;       // 作者名称
  likes: number;        // 点赞数
  image: string;        // 封面图片链接
}
```

### 5.3 博主信息数据结构

```typescript
interface BloggerInfo {
  avatarUrl: string;           // 头像链接
  bloggerName: string;         // 博主名称
  description: string;         // 博主简介
  bloggerId: string;           // 小红书号
  followersCount: number;      // 粉丝数
  bloggerUrl: string;          // 博主主页链接
  captureTimestamp: number;    // 采集时间戳
}
```

### 5.4 飞书配置数据结构

```typescript
interface FeishuConfig {
  ordeid: string;              // 订单号
  basetoken: string;           // 多维表格授权码
  knowledgeurl: string;        // 「采集库」表格链接
  blogger_noteurl: string;     // 「小红书博主笔记」表格链接
  bloggerurl: string;          // 「小红书博主库」表格链接
}
```

---

## 6. 技术实现方案

### 6.1 技术架构

```
┌──────────────────────────────────────────┐
│            Chrome Extension              │
├──────────────────────────────────────────┤
│  UI层 (sidebar.html + sidebar.css)      │
│  - 侧边栏界面                            │
│  - Tab切换                               │
│  - 卡片展示                              │
├──────────────────────────────────────────┤
│  逻辑层 (sidebar.js)                     │
│  - 用户交互处理                          │
│  - 数据管理                              │
│  - 导出功能                              │
│  - 飞书同步                              │
├──────────────────────────────────────────┤
│  消息层 (background.js)                  │
│  - 打开侧边栏                            │
│  - 消息转发                              │
├──────────────────────────────────────────┤
│  数据采集层 (content.js)                 │
│  - DOM解析                               │
│  - 页面滚动控制                          │
│  - 数据提取                              │
└──────────────────────────────────────────┘
           ↓                ↓
    ┌─────────┐      ┌──────────┐
    │小红书网页│      │ Coze API │
    └─────────┘      └──────────┘
                           ↓
                     ┌──────────┐
                     │飞书多维表格│
                     └──────────┘
```

### 6.2 关键技术选型

| 技术层 | 技术选型 | 理由 |
|-------|---------|------|
| 插件框架 | Chrome Extension Manifest V3 | 最新标准，安全性更好 |
| UI框架 | 原生HTML+CSS | 轻量，无需打包 |
| 数据采集 | DOM查询 + XPath | 灵活应对页面结构 |
| 数据存储 | localStorage | 配置持久化 |
| 数据导出 | CSV格式 | Excel兼容性好 |
| 飞书集成 | Coze工作流 | 简化API调用 |

### 6.3 核心算法

#### 6.3.1 滚动加载算法

```javascript
async function fetchAllNotes() {
  const noteList = [];
  const processedUrls = new Set();
  
  let scrollPosition = 0;
  let noNewContentCount = 0;
  const maxScrollCount = 50;
  const scrollStep = 500;
  
  for (let i = 0; i < maxScrollCount; i++) {
    // 获取当前页面笔记
    const noteCards = document.querySelectorAll('.note-card');
    
    let foundNewContent = false;
    for (const card of noteCards) {
      const url = extractUrl(card);
      if (!processedUrls.has(url)) {
        noteList.push(extractNoteInfo(card));
        processedUrls.add(url);
        foundNewContent = true;
      }
    }
    
    // 判断是否继续
    if (foundNewContent) {
      noNewContentCount = 0;
    } else {
      noNewContentCount++;
      if (noNewContentCount >= 5) break;
    }
    
    // 滚动页面
    scrollPosition += scrollStep;
    window.scrollTo(0, scrollPosition);
    await sleep(1500);
  }
  
  return noteList;
}
```

#### 6.3.2 数字单位转换算法

```javascript
function convertCount(text) {
  const cleanText = text.trim().replace(/\s/g, '');
  
  // 1.2w / 1.2万 → 12000
  if (cleanText.includes('w') || cleanText.includes('万')) {
    const num = parseFloat(cleanText);
    return Math.round(num * 10000);
  }
  
  // 1.5k / 1.5千 → 1500
  if (cleanText.includes('k') || cleanText.includes('千')) {
    const num = parseFloat(cleanText);
    return Math.round(num * 1000);
  }
  
  // 普通数字
  return parseInt(cleanText) || 0;
}
```

#### 6.3.3 时间格式转换算法

```javascript
function parsePublishDate(rawDate) {
  const now = new Date();
  
  // 昨天 23:31
  if (rawDate.includes('昨天')) {
    const [hour, minute] = rawDate.match(/(\d{1,2}):(\d{2})/).slice(1);
    const yesterday = new Date(now);
    yesterday.setDate(yesterday.getDate() - 1);
    yesterday.setHours(hour, minute, 0, 0);
    return formatDate(yesterday);
  }
  
  // 2天前
  if (rawDate.includes('天前')) {
    const days = parseInt(rawDate);
    const date = new Date(now);
    date.setDate(date.getDate() - days);
    date.setHours(20, 0, 0, 0);
    return formatDate(date);
  }
  
  // 3小时前
  if (rawDate.includes('小时前')) {
    const hours = parseInt(rawDate);
    const date = new Date(now);
    date.setHours(date.getHours() - hours);
    return formatDate(date);
  }
  
  // 12-13 → 2024/12/13 20:00
  if (/^\d{1,2}-\d{1,2}$/.test(rawDate)) {
    const [month, day] = rawDate.split('-');
    return `${now.getFullYear()}/${month}/${day} 20:00`;
  }
  
  return rawDate;
}

function formatDate(date) {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hour = String(date.getHours()).padStart(2, '0');
  const minute = String(date.getMinutes()).padStart(2, '0');
  return `${year}/${month}/${day} ${hour}:${minute}`;
}
```

### 6.4 代码规范

#### 6.4.1 命名规范

**变量命名**：
```javascript
// ✅ 使用驼峰命名
const noteList = [];
const currentScrollPosition = 0;

// ✅ 布尔值用is/has前缀
const isNotePage = checkPage();
const hasNewContent = false;

// ✅ 常量用大写下划线
const MAX_SCROLL_COUNT = 50;
const DEFAULT_WAIT_TIME = 1500;
```

**函数命名**：
```javascript
// ✅ 动词开头，描述清晰
function fetchAllNotes() {}
function parseNoteContent() {}
function convertCountNumber() {}
function validateFeishuConfig() {}
```

#### 6.4.2 注释规范

```javascript
/**
 * 采集博主主页的所有笔记
 * @returns {Promise<Array>} 笔记数据数组
 * @throws {Error} 如果不在博主主页会抛出错误
 */
async function fetchAllNotes() {
  // 1. 验证页面
  if (!isOnBloggerPage()) {
    throw new Error('请在博主主页使用此功能');
  }
  
  // 2. 初始化变量
  const noteList = [];
  
  // 3. 滚动采集
  // ...
  
  return noteList;
}
```

#### 6.4.3 错误处理规范

```javascript
// ✅ 使用try-catch
try {
  const data = await fetchNoteData();
  processData(data);
} catch (error) {
  console.error('采集失败:', error);
  showErrorMessage('采集失败，请重试');
}

// ✅ 提供默认值
const title = titleElement?.textContent?.trim() || '无标题';

// ✅ 验证参数
function syncToFeishu(config) {
  if (!config.ordeid || !config.basetoken) {
    showErrorMessage('请先完成飞书配置');
    return;
  }
  // ...
}
```

---

## 7. 用户安装配置流程

### 7.1 插件安装步骤

**前置条件**：
- 用户使用Chrome浏览器（或Edge/Brave等Chromium内核浏览器）
- 浏览器版本 ≥ 88

**安装流程**：

```
步骤1：下载插件包
  - 用户收到red-helper.zip文件
  
步骤2：解压文件
  - 解压到本地文件夹
  - 文件夹命名：red-helper
  
步骤3：打开Chrome扩展程序页面
  - 在浏览器地址栏输入：chrome://extensions/
  - 或通过菜单：更多工具 → 扩展程序
  
步骤4：启用开发者模式
  - 页面右上角打开"开发者模式"开关
  
步骤5：加载插件
  - 点击"加载已解压的扩展程序"
  - 选择red-helper文件夹
  
步骤6：验证安装
  - 插件列表中出现"红薯助手"
  - 状态显示"已启用"
  - 浏览器工具栏出现插件图标
```

**常见问题处理**：

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| 找不到"加载已解压的扩展程序" | 未开启开发者模式 | 打开页面右上角的开关 |
| 加载失败：Manifest错误 | 文件夹选错了 | 选择包含manifest.json的文件夹 |
| 插件图标不显示 | 图标文件缺失 | 重新下载完整压缩包 |
| 点击图标无反应 | 权限不足 | 刷新当前页面重试 |

### 7.2 飞书配置流程

**用户需要准备的信息**：

1. **订单号**（由提供方给出）
2. **飞书多维表格授权码（basetoken）**
   - 打开飞书多维表格
   - 右上角"..."→ 高级 → API访问
   - 复制Personal Access Token

3. **飞书表格链接**
   - 打开对应的飞书多维表格
   - 复制浏览器地址栏的URL

**配置步骤**：

```
步骤1：打开配置页面
  - 点击插件图标，打开侧边栏
  - 切换到"配置"Tab
  
步骤2：填写配置信息
  - 订单号：粘贴订单号
  - 多维表格授权码：粘贴basetoken
  - 「采集库」表格链接：粘贴单篇笔记表格URL
  - 「小红书博主库」表格链接：粘贴博主信息表格URL
  - 「小红书博主笔记」表格链接：粘贴博主笔记表格URL
  
步骤3：保存配置
  - 点击"保存配置"按钮
  - 看到提示"配置已保存"
  
步骤4：验证配置
  - 采集一条笔记
  - 点击"同步飞书"
  - 检查飞书表格是否收到数据
```

### 7.3 使用说明文档

**需要提供给用户的文档**：

```markdown
# 红薯助手使用说明

## 一、功能介绍
1. 单篇笔记采集：保存单篇笔记的完整信息
2. 博主笔记采集：批量采集博主的所有笔记
3. 博主信息采集：获取博主的基础资料
4. 数据导出：导出为Excel格式
5. 飞书同步：一键同步到飞书多维表格

## 二、快速开始

### 采集单篇笔记
1. 打开任意小红书笔记详情页
2. 点击浏览器右上角的插件图标
3. 切换到"单篇笔记"Tab
4. 点击"开始采集"
5. 等待采集完成（约2-3秒）
6. 选择"导出Excel"或"同步飞书"

### 采集博主全部笔记
1. 打开博主主页（URL包含/user/profile/）
2. 点击插件图标，切换到"博主笔记"Tab
3. 点击"开始采集"
4. 插件会自动滚动页面，实时显示进度
5. 采集完成后，所有笔记显示在卡片中
6. 可选择导出或同步到飞书

## 三、注意事项
1. 采集过程中请勿关闭插件窗口
2. 网络不稳定可能导致采集失败，重试即可
3. 批量采集时，建议笔记数量 < 200条
4. 飞书同步需要先完成配置

## 四、常见问题
Q: 提示"请在笔记详情页使用"？
A: 确保URL包含/explore/或/discovery/item

Q: 采集到的笔记数量不对？
A: 小红书可能限制加载数量，尝试手动滚动到底部后再采集

Q: 同步飞书失败？
A: 检查配置信息是否正确，特别是basetoken和表格链接
```

---

## 8. 开发计划与里程碑

### 8.1 开发阶段划分

```
阶段1：基础框架搭建（2天）
  - 插件项目初始化
  - manifest.json配置
  - 侧边栏UI框架
  - 消息通信机制

阶段2：数据采集功能（5天）
  - 单篇笔记采集（1.5天）
  - 博主笔记批量采集（2天）
  - 博主信息采集（1天）
  - 数据格式化处理（0.5天）

阶段3：数据管理功能（2天）
  - 采集结果展示
  - 删除/清空功能
  - 数据导出Excel

阶段4：飞书集成（2天）
  - 配置管理界面
  - 数据格式转换
  - API调用与错误处理

阶段5：UI优化与测试（2天）
  - 界面美化
  - 交互优化
  - 功能测试
  - Bug修复

阶段6：文档与打包（1天）
  - 使用说明文档
  - 安装指南
  - 打包发布
```

### 8.2 里程碑节点

| 里程碑 | 交付物 | 验收标准 | 目标时间 |
|-------|-------|---------|---------|
| M1: 框架完成 | 可运行的插件框架 | 插件能安装和打开侧边栏 | D2 |
| M2: 采集功能完成 | 三大采集功能 | 能正确采集数据，准确率≥95% | D7 |
| M3: 导出功能完成 | Excel导出 | 导出文件能用Excel打开，中文正常显示 | D9 |
| M4: 飞书集成完成 | 飞书同步 | 数据能正确同步到飞书表格 | D11 |
| M5: V1.0发布 | 完整插件包+文档 | 通过完整功能测试，文档齐全 | D14 |

### 8.3 开发资源需求

**人力需求**：
- 前端开发：1人
- 测试（可选）：0.5人

**技术储备要求**：
- 熟悉Chrome Extension开发
- 熟悉DOM操作和网页爬虫
- 了解飞书API或Coze使用

**工具需求**：
- Chrome浏览器
- 代码编辑器（VSCode推荐）
- 飞书账号（测试用）

---

## 9. 风险评估与应对

### 9.1 技术风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|-------|------|---------|
| 小红书网页改版 | 高 | 高 | 1. 使用多选择器备选方案<br>2. 定期检查更新<br>3. 提供快速修复机制 |
| 反爬虫机制 | 中 | 高 | 1. 控制采集速度<br>2. 模拟人工行为<br>3. 添加随机延迟 |
| 飞书API变更 | 低 | 中 | 使用Coze中间层降低影响 |
| 浏览器兼容性 | 低 | 中 | 在主流浏览器测试（Chrome/Edge） |

### 9.2 用户体验风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|-------|------|---------|
| 安装门槛高 | 高 | 中 | 1. 提供详细图文教程<br>2. 录制安装视频<br>3. 提供安装问题FAQ |
| 配置复杂 | 中 | 中 | 1. 简化配置项<br>2. 提供配置指引<br>3. 配置验证功能 |
| 采集失败率高 | 中 | 高 | 1. 增强错误提示<br>2. 提供重试机制<br>3. 显示采集进度 |

### 9.3 法律合规风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|-------|------|---------|
| 版权侵权 | 低 | 高 | 1. 完全重写代码<br>2. 重新设计UI<br>3. 更改所有文案<br>4. 明确标注独立开发 |
| 数据隐私 | 低 | 中 | 1. 本地存储配置<br>2. 不收集用户数据<br>3. 数据由用户控制 |
| 平台违规 | 中 | 中 | 1. 仅供个人使用<br>2. 不提供商业服务<br>3. 控制采集频率 |

### 9.4 应急预案

**预案1：小红书网页改版**
```
应急措施：
1. 立即通知用户停止使用
2. 紧急分析新版DOM结构
3. 更新选择器
4. 发布热修复版本
预计修复时间：1-2天
```

**预案2：大量用户反馈采集失败**
```
应急措施：
1. 收集用户反馈和错误截图
2. 定位问题原因
3. 根据优先级修复：
   - P0问题：24小时内修复
   - P1问题：3天内修复
4. 发布补丁版本
```

**预案3：飞书同步问题**
```
应急措施：
1. 检查Coze工作流状态
2. 验证API是否正常
3. 提供临时方案：先导出Excel，手动导入飞书
4. 联系Coze技术支持
```

---

## 10. 附录

### 10.1 技术参考文档

- [Chrome Extension官方文档](https://developer.chrome.com/docs/extensions/)
- [飞书开放平台](https://open.feishu.cn/)
- [Coze平台](https://www.coze.cn/)

### 10.2 UI设计稿（待补充）

- 侧边栏界面设计
- 配置页面设计
- 卡片样式设计
- 按钮状态设计

### 10.3 测试用例（待补充）

- 功能测试用例
- 兼容性测试用例
- 异常场景测试用例

### 10.4 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| V1.0 | 2025-01-03 | PRD初稿完成 |

---

## 📝 PRD变更记录

| 日期 | 变更人 | 变更内容 | 版本 |
|------|-------|---------|------|
| 2025-01-03 | [您的名字] | 创建PRD V1.0 | V1.0 |

---

**文档结束**

如有疑问或需要补充，请联系产品负责人。

